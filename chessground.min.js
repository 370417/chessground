!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Chessground=e()}}(function(){return function e(t,n,r){function o(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return o(n?n:e)},u,u.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){function r(e,t){var n=new i(t);return o.render(e,a(n)),l(n)}var o=e("mithril/render"),i=e("./ctrl"),a=e("./view"),l=e("./api");t.exports=r,t.exports.controller=i,t.exports.view=a,t.exports.fen=e("./fen"),t.exports.util=e("./util"),t.exports.configure=e("./configure"),t.exports.anim=e("./anim"),t.exports.board=e("./board"),t.exports.drag=e("./drag")},{"./anim":10,"./api":11,"./board":12,"./configure":13,"./ctrl":15,"./drag":17,"./fen":19,"./util":23,"./view":24,"mithril/render":4}],2:[function(e,t,n){!function(e){function n(e,t){if("object"!==o(e))return t;for(var r in t)e[r]="object"===o(e[r])&&"object"===o(t[r])?n(e[r],t[r]):t[r];return e}function r(e,t,r){var a=r[0],l=r.length;(e||"object"!==o(a))&&(a={});for(var s=0;l>s;++s){var c=r[s],u=o(c);if("object"===u)for(var d in c){var f=e?i.clone(c[d]):c[d];a[d]=t?n(a[d],f):f}}return a}function o(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var i=function(e){return r(e===!0,!1,arguments)},a="merge";i.recursive=function(e){return r(e===!0,!0,arguments)},i.clone=function(e){var t,n,r=e,a=o(e);if("array"===a)for(r=[],n=e.length,t=0;n>t;++t)r[t]=i.clone(e[t]);else if("object"===a){r={};for(t in e)r[t]=i.clone(e[t])}return r},e?t.exports=i:window[a]=i}("object"==typeof t&&t&&"object"==typeof t.exports&&t.exports)},{}],3:[function(e,t,n){var r=e("./render/hyperscript");r.trust=e("./render/trust"),r.fragment=e("./render/fragment"),t.exports=r},{"./render/fragment":5,"./render/hyperscript":6,"./render/trust":8}],4:[function(e,t,n){t.exports=e("./render/render")(window)},{"./render/render":7}],5:[function(e,t,n){"use strict";var r=e("../render/vnode");t.exports=function(e,t){return r("[",e.key,e,r.normalizeChildren(t),void 0,void 0)}},{"../render/vnode":9}],6:[function(e,t,n){"use strict";function r(e){if(null==e||"string"!=typeof e&&null==e.view)throw Error("The selector must be either a string or a component.");if("string"==typeof e&&void 0===a[e]){for(var t,n,r=[],l={};t=i.exec(e);){var s=t[1],c=t[2];if(""===s&&""!==c)n=c;else if("#"===s)l.id=c;else if("."===s)r.push(c);else if("["===t[3][0]){var u=t[6];u&&(u=u.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),l[t[4]]=u||!0}}r.length>0&&(l.className=r.join(" ")),a[e]=function(e,t){var r,i,a=!1,s=e.className||e["class"];for(var c in l)e[c]=l[c];void 0!==s&&(void 0!==e["class"]&&(e["class"]=void 0,e.className=s),void 0!==l.className&&(e.className=l.className+" "+s));for(var c in e)if("key"!==c){a=!0;break}return t instanceof Array&&1==t.length&&null!=t[0]&&"#"===t[0].tag?i=t[0].children:r=t,o(n||"div",e.key,a?e:void 0,r,i,void 0)}}var d,f,p;if(null!=arguments[1]&&("object"!=typeof arguments[1]||void 0!==arguments[1].tag||arguments[1]instanceof Array)?p=1:(d=arguments[1],p=2),arguments.length===p+1)f=arguments[p]instanceof Array?arguments[p]:[arguments[p]];else{f=[];for(var v=p;v<arguments.length;v++)f.push(arguments[v])}return"string"==typeof e?a[e](d||{},o.normalizeChildren(f)):o(e,d&&d.key,d||{},o.normalizeChildren(f),void 0,void 0)}var o=e("../render/vnode"),i=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,a={};t.exports=r},{"../render/vnode":9}],7:[function(e,t,n){"use strict";var r=e("../render/vnode");t.exports=function(e){function t(e){return I=e}function n(e,t,n,r,i,a,l){for(var s=n;r>s;s++){var c=t[s];null!=c&&k(e,o(c,i,l),a)}}function o(e,t,n){var r=e.tag;if(null!=e.attrs&&L(e.attrs,e,t),"string"!=typeof r)return c(e,t,n);switch(r){case"#":return i(e);case"<":return a(e);case"[":return l(e,t,n);default:return s(e,t,n)}}function i(e){return e.dom=U.createTextNode(e.children)}function a(e){var t=e.children.match(/^\s*?<(\w+)/im)||[],n={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"}[t[1]]||"div",r=U.createElement(n);r.innerHTML=e.children,e.dom=r.firstChild,e.domSize=r.childNodes.length;for(var o,i=U.createDocumentFragment();o=r.firstChild;)i.appendChild(o);return i}function l(e,t,r){var o=U.createDocumentFragment();if(null!=e.children){var i=e.children;n(o,i,0,i.length,t,null,r)}return e.dom=o.firstChild,e.domSize=o.childNodes.length,o}function s(e,t,o){var i=e.tag;switch(e.tag){case"svg":o="http://www.w3.org/2000/svg";break;case"math":o="http://www.w3.org/1998/Math/MathML"}var a=e.attrs,l=a&&a.is,s=o?l?U.createElementNS(o,i,{is:l}):U.createElementNS(o,i):l?U.createElement(i,{is:l}):U.createElement(i);if(e.dom=s,null!=a&&A(e,a,o),null!=e.attrs&&null!=e.attrs.contenteditable)x(e);else if(null!=e.text&&(""!==e.text?s.textContent=e.text:e.children=[r("#",void 0,void 0,e.text,void 0,void 0)]),null!=e.children){var c=e.children;n(s,c,0,c.length,t,null,o),D(e)}return s}function c(e,t,n){e.state||(e.state={}),B(e.state,e.tag);var i=e.tag.view;if(null!=i.reentrantLock)return G;if(i.reentrantLock=!0,L(e.tag,e,t),e.instance=r.normalize(i.call(e.state,e)),i.reentrantLock=null,null!=e.instance){if(e.instance===e)throw Error("A view cannot return the vnode it received as arguments");var a=o(e.instance,t,n);return e.dom=e.instance.dom,e.domSize=null!=e.dom?e.instance.domSize:0,a}return e.domSize=0,G}function u(e,t,r,i,a,l){if(t!==r&&(null!=t||null!=r))if(null==t)n(e,r,0,r.length,i,a,void 0);else if(null==r)P(t,0,t.length,r);else{var s=g(t,r);if(s&&(t=t.concat(t.pool)),t.length===r.length&&null!=r[0]&&null==r[0].key)for(var c=0;c<t.length;c++)t[c]===r[c]||null==t[c]&&null==r[c]||(null==t[c]?k(e,o(r[c],i,l),w(t,c+1,a)):null==r[c]?P(t,c,c+1,r):d(e,t[c],r[c],i,w(t,c+1,a),s,l),s&&t[c].tag===r[c].tag&&k(e,y(t[c]),w(t,c+1,a)));else{for(var u,f=0,p=0,v=t.length-1,h=r.length-1;v>=f&&h>=p;){var m=t[f],x=r[p];if(m!==x||s)if(null!=m&&null!=x&&m.key===x.key)f++,p++,d(e,m,x,i,w(t,f,a),s,l),s&&m.tag===x.tag&&k(e,y(m),a);else{var m=t[v];if(m!==x||s){if(null==m||null==x||m.key!==x.key)break;d(e,m,x,i,w(t,v+1,a),s,l),(s||h>p)&&k(e,y(m),w(t,f,a)),v--,p++}else v--,p++}else f++,p++}for(;v>=f&&h>=p;){var m=t[v],x=r[h];if(m!==x||s)if(null!=m&&null!=x&&m.key===x.key)d(e,m,x,i,w(t,v+1,a),s,l),s&&m.tag===x.tag&&k(e,y(m),a),null!=m.dom&&(a=m.dom),v--,h--;else{if(u||(u=b(t,v)),null!=x){var C=u[x.key];if(null!=C){var M=t[C];d(e,M,x,i,w(t,v+1,a),s,l),k(e,y(M),a),t[C].skip=!0,null!=M.dom&&(a=M.dom)}else{var S=o(x,i,void 0);k(e,S,a),a=S}}h--}else v--,h--;if(p>h)break}n(e,r,p,h+1,i,a,l),P(t,f,v+1,r)}}}function d(e,t,n,r,i,a,l){var s=t.tag,c=n.tag;if(s===c){if(n.state=t.state,n.events=t.events,W(n,t))return;if(null!=n.attrs&&R(n.attrs,n,r,a),"string"==typeof s)switch(s){case"#":f(t,n);break;case"<":p(e,t,n,i);break;case"[":v(e,t,n,r,i,l);break;default:h(t,n,r,l)}else m(e,t,n,r,i,a,l)}else M(t,null),k(e,o(n,r,l),i)}function f(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children),t.dom=e.dom}function p(e,t,n,r){t.children!==n.children?(y(t),k(e,a(n),r)):(n.dom=t.dom,n.domSize=t.domSize)}function v(e,t,n,r,o,i){u(e,t.children,n.children,r,o,i);var a=0,l=n.children;if(n.dom=null,null!=l){for(var s=0;s<l.length;s++){var c=l[s];null!=c&&null!=c.dom&&(null==n.dom&&(n.dom=c.dom),a+=c.domSize||1)}1!==a&&(n.domSize=a)}}function h(e,t,n,o){var i=t.dom=e.dom;switch(t.tag){case"svg":o="http://www.w3.org/2000/svg";break;case"math":o="http://www.w3.org/1998/Math/MathML"}"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0)),O(t,e.attrs,t.attrs,o),null!=t.attrs&&null!=t.attrs.contenteditable?x(t):null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[r("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[r("#",void 0,void 0,t.text,void 0,void 0)]),u(i,e.children,t.children,n,null,o))}function m(e,t,n,i,a,l,s){n.instance=r.normalize(n.tag.view.call(n.state,n)),R(n.tag,n,i,l),null!=n.instance?(null==t.instance?k(e,o(n.instance,i,s),a):d(e,t.instance,n.instance,i,a,l,s),n.dom=n.instance.dom,n.domSize=n.instance.domSize):null!=t.instance?(M(t.instance,null),n.dom=void 0,n.domSize=0):(n.dom=t.dom,n.domSize=t.domSize)}function g(e,t){if(null!=e.pool&&Math.abs(e.pool.length-t.length)<=Math.abs(e.length-t.length)){var n=e[0]&&e[0].children&&e[0].children.length||0,r=e.pool[0]&&e.pool[0].children&&e.pool[0].children.length||0,o=t[0]&&t[0].children&&t[0].children.length||0;if(Math.abs(r-o)<=Math.abs(n-o))return!0}return!1}function b(e,t){for(var n={},r=0,r=0;t>r;r++){var o=e[r];if(null!=o){var i=o.key;null!=i&&(n[i]=r)}}return n}function y(e){var t=e.domSize;if(null!=t||null==e.dom){var n=U.createDocumentFragment();if(t>0){for(var r=e.dom;--t;)n.appendChild(r.nextSibling);n.insertBefore(r,n.firstChild)}return n}return e.dom}function w(e,t,n){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return n}function k(e,t,n){n&&n.parentNode?e.insertBefore(t,n):e.appendChild(t)}function x(e){var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var n=t[0].children;e.dom.innerHTML!==n&&(e.dom.innerHTML=n)}else if(null!=t||null!=e.text)throw new Error("Child node of a contenteditable must be trusted")}function P(e,t,n,r){for(var o=t;n>o;o++){var i=e[o];null!=i&&(i.skip?i.skip=!1:M(i,r))}}function C(e){var t=!1;return function(){t||(t=!0,e())}}function M(e,t){function n(){if(++o===r&&(E(e),e.dom)){var n=e.domSize||1;if(n>1)for(var i=e.dom;--n;)S(i.nextSibling);S(e.dom),null==t||null!=e.domSize||j(e.attrs)||"string"!=typeof e.tag||(t.pool?t.pool.push(e):t.pool=[e])}}var r=1,o=0;e.attrs&&e.attrs.onbeforeremove&&(r++,e.attrs.onbeforeremove.call(e.state,e,C(n))),"string"!=typeof e.tag&&e.tag.onbeforeremove&&(r++,e.tag.onbeforeremove.call(e.state,e,C(n))),n()}function S(e){var t=e.parentNode;null!=t&&t.removeChild(e)}function E(e){if(e.attrs&&e.attrs.onremove&&e.attrs.onremove.call(e.state,e),"string"!=typeof e.tag&&e.tag.onremove&&e.tag.onremove.call(e.state,e),null!=e.instance)E(e.instance);else{var t=e.children;if(t instanceof Array)for(var n=0;n<t.length;n++){var r=t[n];null!=r&&E(r)}}}function A(e,t,n){for(var r in t)z(e,r,null,t[r],n)}function z(e,t,n,r,o){var i=e.dom;if("key"!==t&&(n!==r||N(e,t)||"object"==typeof r)&&"undefined"!=typeof r&&!T(t)){var a=t.indexOf(":");if(a>-1&&"xlink"===t.substr(0,a))i.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(a+1),r);else if("o"===t[0]&&"n"===t[1]&&"function"==typeof r)K(e,t,r);else if("style"===t)F(i,n,r);else if(t in i&&!q(t)&&void 0===o){if("input"===e.tag&&"value"===t&&e.dom.value===r&&e.dom===U.activeElement)return;i[t]=r}else"boolean"==typeof r?r?i.setAttribute(t,""):i.removeAttribute(t):i.setAttribute("className"===t?"class":t,r)}}function D(e){var t=e.attrs;"select"===e.tag&&null!=t&&("value"in t&&z(e,"value",null,t.value,void 0),"selectedIndex"in t&&z(e,"selectedIndex",null,t.selectedIndex,void 0))}function O(e,t,n,r){if(null!=n)for(var o in n)z(e,o,t&&t[o],n[o],r);if(null!=t)for(var o in t)null!=n&&o in n||("className"===o&&(o="class"),"o"!==o[0]||"n"!==o[1]||T(o)?"key"!==o&&e.dom.removeAttribute(o):K(e,o,void 0))}function N(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===U.activeElement}function T(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function q(e){return"href"===e||"list"===e||"form"===e||"width"===e||"height"===e}function j(e){return null!=e&&(e.oncreate||e.onupdate||e.onbeforeremove||e.onremove)}function F(e,t,n){if(t===n&&(e.style.cssText="",t=null),null==n)e.style.cssText="";else if("string"==typeof n)e.style.cssText=n;else{"string"==typeof t&&(e.style.cssText="");for(var r in n)e.style[r]=n[r];if(null!=t&&"string"!=typeof t)for(var r in t)r in n||(e.style[r]="")}}function K(e,t,n){var r=e.dom,o=function(e){var t=n.call(r,e);return"function"==typeof I&&I.call(r,e),t};if(t in r)r[t]="function"==typeof n?o:null;else{var i=t.slice(2);void 0===e.events&&(e.events={}),null!=e.events[t]&&r.removeEventListener(i,e.events[t],!1),"function"==typeof n&&(e.events[t]=o,r.addEventListener(i,e.events[t],!1))}}function L(e,t,n){"function"==typeof e.oninit&&e.oninit.call(t.state,t),"function"==typeof e.oncreate&&n.push(e.oncreate.bind(t.state,t))}function R(e,t,n,r){r?L(e,t,n):"function"==typeof e.onupdate&&n.push(e.onupdate.bind(t.state,t))}function W(e,t){var n,r;return null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate&&(n=e.attrs.onbeforeupdate.call(e.state,e,t)),"string"!=typeof e.tag&&"function"==typeof e.tag.onbeforeupdate&&(r=e.tag.onbeforeupdate.call(e.state,e,t)),void 0===n&&void 0===r||n||r?!1:(e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,!0)}function B(e,t){Object.keys(t).forEach(function(n){e[n]=t[n]})}function X(e,t){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var n=[],o=U.activeElement;null==e.vnodes&&(e.textContent=""),t instanceof Array||(t=[t]),u(e,e.vnodes,r.normalizeChildren(t),n,null,void 0),e.vnodes=t;for(var i=0;i<n.length;i++)n[i]();U.activeElement!==o&&o.focus()}var I,U=e.document,G=U.createDocumentFragment();return{render:X,setEventCallback:t}}},{"../render/vnode":9}],8:[function(e,t,n){"use strict";var r=e("../render/vnode");t.exports=function(e){return null==e&&(e=""),r("<",void 0,void 0,e,void 0,void 0)}},{"../render/vnode":9}],9:[function(e,t,n){function r(e,t,n,r,o,i){return{tag:e,key:t,attrs:n,children:r,text:o,dom:i,domSize:void 0,state:{},events:void 0,instance:void 0,skip:!1}}r.normalize=function(e){return e instanceof Array?r("[",void 0,void 0,r.normalizeChildren(e),void 0,void 0):null!=e&&"object"!=typeof e?r("#",void 0,void 0,e,void 0,void 0):e},r.normalizeChildren=function(e){for(var t=0;t<e.length;t++)e[t]=r.normalize(e[t]);return e},t.exports=r},{}],10:[function(e,t,n){function r(e,t,n){var r=n?u.invertKey(e):e;return{key:r,pos:u.key2pos(r),role:t.role,color:t.color}}function o(e,t){return e.role===t.role&&e.color===t.color}function i(e,t){return t.sort(function(t,n){return u.distance(e.pos,t.pos)-u.distance(e.pos,n.pos)})[0]}function a(e,t){var n=t.bounds(),a=n.width/8,l=n.height/8,s={},c=[],d=[],f=[],p=[],v=e.orientation!==t.orientation,h={},m="white"===t.orientation;for(var g in e.pieces){var b=r(g,e.pieces[g],v);h[b.key]=b}for(var y=0;y<u.allKeys.length;y++){var w=u.allKeys[y];if(w!==t.movable.dropped[1]){var k=t.pieces[w],x=h[w];k?x?o(k,x)||(f.push(x),p.push(r(w,k,!1))):p.push(r(w,k,!1)):x&&f.push(x)}}return p.forEach(function(e){var t=i(e,f.filter(u.partial(o,e)));if(t){var n=m?t.pos:e.pos,r=m?e.pos:t.pos,d=[(n[0]-r[0])*a,(r[1]-n[1])*l];s[e.key]=[d,d],c.push(t.key)}}),f.forEach(function(e){e.key===t.movable.dropped[0]||u.containsX(c,e.key)||(t.items?t.items.render(e.pos,e.key):!1)||d.push({piece:e,opacity:1})}),{anims:s,fadings:d}}function l(e,t){return Math.round(e*t)/t}function s(e){if(e.animation.current.start){var t=1-((new Date).getTime()-e.animation.current.start)/e.animation.current.duration;if(0>=t)e.animation.current={},e.render();else{var n=d.easeInOutCubic(t);for(var r in e.animation.current.anims){var o=e.animation.current.anims[r];o[1]=[l(o[0][0]*n,10),l(o[0][1]*n,10)]}for(var i in e.animation.current.fadings)e.animation.current.fadings[i].opacity=l(n,100);e.render(),u.requestAnimationFrame(function(){s(e)})}}}function c(e,t){var n={orientation:t.orientation,pieces:{}};for(var r in t.pieces)n.pieces[r]={role:t.pieces[r].role,color:t.pieces[r].color};var o=e();if(t.animation.enabled){var i=a(n,t);if(Object.keys(i.anims).length>0||i.fadings.length>0){var l=t.animation.current.start;t.animation.current={start:(new Date).getTime(),duration:t.animation.duration,anims:i.anims,fadings:i.fadings},l||s(t)}else t.renderRAF()}else t.renderRAF();return o}var u=e("./util"),d={easeInOutCubic:function(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}};t.exports=function(e,t,n){return function(){var r=[t].concat(Array.prototype.slice.call(arguments,0));if(t.render){if(t.animation.enabled&&!n)return c(u.partialApply(e,r),t);var o=e.apply(null,r);return t.renderRAF(),o}return e.apply(null,r)}}},{"./util":23}],11:[function(e,t,n){var r=e("./board");t.exports=function(e){return{set:e.set,toggleOrientation:e.toggleOrientation,getOrientation:e.getOrientation,getPieces:function(){return e.data.pieces},getMaterialDiff:function(){return r.getMaterialDiff(e.data)},getFen:e.getFen,move:e.apiMove,newPiece:e.apiNewPiece,setPieces:e.setPieces,setCheck:e.setCheck,playPremove:e.playPremove,playPredrop:e.playPredrop,cancelPremove:e.cancelPremove,cancelPredrop:e.cancelPredrop,cancelMove:e.cancelMove,stop:e.stop,explode:e.explode,setAutoShapes:e.setAutoShapes,setShapes:e.setShapes,data:e.data}}},{"./board":12}],12:[function(e,t,n){function r(e){setTimeout(e,1)}function o(e){e.orientation=F.opposite(e.orientation)}function i(e){e.lastMove=null,k(e,null),c(e),d(e)}function a(e,t){Object.keys(t).forEach(function(n){t[n]?e.pieces[n]=t[n]:delete e.pieces[n]}),e.movable.dropped=[]}function l(e,t){var n=t||e.turnColor;Object.keys(e.pieces).forEach(function(t){e.pieces[t].color===n&&"king"===e.pieces[t].role&&(e.check=t)})}function s(e,t,n){d(e),e.premovable.current=[t,n],r(F.partial(e.premovable.events.set,t,n))}function c(e){e.premovable.current&&(e.premovable.current=null,r(e.premovable.events.unset))}function u(e,t,n){c(e),e.predroppable.current={role:t,key:n},r(F.partial(e.predroppable.events.set,t,n))}function d(e){e.predroppable.current.key&&(e.predroppable.current={},r(e.predroppable.events.unset))}function f(e,t,n){if(e.autoCastle){var r=e.pieces[n];if("king"===r.role){var o=F.key2pos(t);if(5===o[0]&&(1===o[1]||8===o[1])){var i,a,l,s=F.key2pos(n);if(7===s[0]||8===s[0])i=F.pos2key([8,o[1]]),a=F.pos2key([6,o[1]]),l=F.pos2key([7,o[1]]);else{if(3!==s[0]&&1!==s[0])return;i=F.pos2key([1,o[1]]),a=F.pos2key([4,o[1]]),l=F.pos2key([3,o[1]])}delete e.pieces[t],delete e.pieces[n],delete e.pieces[i],e.pieces[l]={role:"king",color:r.color},e.pieces[a]={role:"rook",color:r.color}}}}}function p(e,t,n){var o=L(function(){if(t===n||!e.pieces[t])return!1;var o=e.pieces[n]&&e.pieces[n].color!==e.pieces[t].color?e.pieces[n]:null;return r(F.partial(e.events.move,t,n,o)),e.pieces[n]=e.pieces[t],delete e.pieces[t],e.lastMove=[t,n],e.check=null,f(e,t,n),r(e.events.change),!0},e)();return o&&(e.movable.dropped=[]),o}function v(e,t,n){return e.pieces[n]?!1:(r(F.partial(e.events.dropNewPiece,t,n)),e.pieces[n]=t,e.lastMove=[n,n],e.check=null,r(e.events.change),e.movable.dropped=[],e.movable.dests={},e.turnColor=F.opposite(e.turnColor),e.renderRAF(),!0)}function h(e,t,n){var r=p(e,t,n);return r&&(e.movable.dests={},e.turnColor=F.opposite(e.turnColor)),r}function m(e,t,n){return p(e,t,n)}function g(e,t,n){return v(e,t,n)}function b(e,t,n){if(n)if(P(e,t,n)){if(h(e,t,n)){var o=R.stop();return k(e,null),r(F.partial(e.movable.events.after,t,n,{premove:!1,holdTime:o})),!0}}else S(e,t,n)?(s(e,t,n),k(e,null)):x(e,n)||M(e,n)?(k(e,n),R.start()):k(e,null);else R.cancel(),k(e,null),"trash"===e.movable.dropOff&&(delete e.pieces[t],r(e.events.change))}function y(e,t,n){if(C(e,t,n)){var o=e.pieces[t];delete e.pieces[t],v(e,o,n),e.movable.dropped=[],r(F.partial(e.movable.events.afterNewPiece,o.role,n,{predrop:!1}))}else E(e,t,n)?u(e,e.pieces[t].role,n):(c(e),d(e));delete e.pieces[t],k(e,null)}function w(e,t){e.selected?t&&(e.selected!==t||e.draggable.enabled)?e.selectable.enabled&&e.selected!==t?b(e,e.selected,t)&&(e.stats.dragged=!1):R.start():(k(e,null),R.cancel()):(x(e,t)||M(e,t))&&(k(e,t),R.start()),t&&r(F.partial(e.events.select,t))}function k(e,t){e.selected=t,e.premovable.dests=t&&M(e,t)?K(e.pieces,t,e.premovable.castle):null}function x(e,t){var n=e.pieces[t];return n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function P(e,t,n){return t!==n&&x(e,t)&&(e.movable.free||F.containsX(e.movable.dests[t],n))}function C(e,t,n){var r=e.pieces[t];return r&&n&&(t===n||!e.pieces[n])&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function M(e,t){var n=e.pieces[t];return n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function S(e,t,n){return t!==n&&M(e,t)&&F.containsX(K(e.pieces,t,e.premovable.castle),n)}function E(e,t,n){var r=e.pieces[t];return r&&n&&(!e.pieces[n]||e.pieces[n].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==r.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===r.color&&e.turnColor!==r.color}function A(e,t){var n=e.pieces[t];return n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function z(e){var t=e.premovable.current;if(t){var n=t[0],o=t[1],i=!1;return P(e,n,o)&&h(e,n,o)&&(r(F.partial(e.movable.events.after,n,o,{premove:!0})),i=!0),c(e),i}}function D(e,t){var n=e.predroppable.current,o=!1;if(n.key){if(t(n)){var i={role:n.role,color:e.movable.color};v(e,i,n.key)&&(r(F.partial(e.movable.events.afterNewPiece,n.role,n.key,{predrop:!0})),o=!0)}return d(e),o}}function O(e){c(e),d(e),w(e,null)}function N(e){e.movable.color=null,e.movable.dests={},O(e)}function T(e,t,n){if(n||e.bounds){n=n||e.bounds();var r=Math.ceil(8*((t[0]-n.left)/n.width));r="white"===e.orientation?r:9-r;var o=Math.ceil(8-8*((t[1]-n.top)/n.height));return o="white"===e.orientation?o:9-o,r>0&&9>r&&o>0&&9>o?F.pos2key([r,o]):void 0}}function q(e){var t={king:0,queen:0,rook:0,bishop:0,knight:0,pawn:0};for(var n in e.pieces){var r=e.pieces[n];t[r.role]+="white"===r.color?1:-1}var o={white:{},black:{}};for(var i in t){var a=t[i];a>0?o.white[i]=a:0>a&&(o.black[i]=-a)}return o}function j(e){var t=0;for(var n in e.pieces)t+=W[e.pieces[n].role]*("white"===e.pieces[n].color?1:-1);return t}var F=e("./util"),K=e("./premove"),L=e("./anim"),R=e("./hold"),W={pawn:1,knight:3,bishop:3,rook:5,queen:9,king:0};t.exports={reset:i,toggleOrientation:o,setPieces:a,setCheck:l,selectSquare:w,setSelected:k,isDraggable:A,canMove:P,userMove:b,dropNewPiece:y,apiMove:m,apiNewPiece:g,playPremove:z,playPredrop:D,unsetPremove:c,unsetPredrop:d,cancelMove:O,stop:N,getKeyAtDomPos:T,getMaterialDiff:q,getScore:j}},{"./anim":10,"./hold":20,"./premove":21,"./util":23}],13:[function(e,t,n){var r=e("merge"),o=e("./board"),i=e("./fen");t.exports=function(e,t){if(t&&(t.movable&&t.movable.dests&&delete e.movable.dests,r.recursive(e,t),e.fen&&(e.pieces=i.read(e.fen),e.check=t.check,e.drawable.shapes=[],delete e.fen),e.check===!0&&o.setCheck(e),e.movable.dropped=[],e.selected&&o.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<40)&&(e.animation.enabled=!1),!e.movable.rookCastle)){var n="white"===e.movable.color?1:8,a="e"+n;if(e.movable.dests){var l=e.movable.dests[a];if(!l||"king"!==e.pieces[a].role)return;e.movable.dests[a]=l.filter(function(e){return e!=="a"+n&&e!=="h"+n})}}}},{"./board":12,"./fen":19,merge:2}],14:[function(e,t,n){function r(e,t,n){var r=document.createElement("coords");return r.className=t,e.forEach(function(e){var t=document.createElement("coord");t.textContent=e,r.appendChild(t)}),r}var o=e("./util");t.exports=function(e,t){o.requestAnimationFrame(function(){var n=document.createDocumentFragment(),i="black"===e?" black":"";n.appendChild(r(o.ranks,"ranks"+i)),n.appendChild(r(o.files,"files"+i)),t.appendChild(n)});var e;return function(n){if(n!==e){e=n;var r=t.querySelectorAll("coords");for(i=0;i<r.length;++i)r[i].classList.toggle("black","black"===n)}}}},{"./util":23}],15:[function(e,t,n){var r=e("./board"),o=e("./data"),i=e("./fen"),a=e("./configure"),l=e("./anim"),s=e("./drag");t.exports=function(e){this.data=o(e),this.vm={exploding:!1},this.getFen=function(){return i.write(this.data.pieces)}.bind(this),this.getOrientation=function(){return this.data.orientation}.bind(this),this.set=l(a,this.data),this.toggleOrientation=function(){l(r.toggleOrientation,this.data)(),this.data.redrawCoords&&this.data.redrawCoords(this.data.orientation)}.bind(this),this.setPieces=l(r.setPieces,this.data),this.selectSquare=l(r.selectSquare,this.data,!0),this.apiMove=l(r.apiMove,this.data),this.apiNewPiece=l(r.apiNewPiece,this.data),this.playPremove=l(r.playPremove,this.data),this.playPredrop=l(r.playPredrop,this.data),this.cancelPremove=l(r.unsetPremove,this.data,!0),this.cancelPredrop=l(r.unsetPredrop,this.data,!0),this.setCheck=l(r.setCheck,this.data,!0),this.cancelMove=l(function(e){r.cancelMove(e),s.cancel(e)}.bind(this),this.data,!0),this.stop=l(function(e){r.stop(e),s.cancel(e)}.bind(this),this.data,!0),this.explode=function(e){this.data.render&&(this.vm.exploding={stage:1,keys:e},this.data.renderRAF(),setTimeout(function(){this.vm.exploding.stage=2,this.data.renderRAF(),setTimeout(function(){this.vm.exploding=!1,this.data.renderRAF()}.bind(this),120)}.bind(this),120))}.bind(this),this.setAutoShapes=function(e){l(function(t){t.drawable.autoShapes=e},this.data,!1)()}.bind(this),this.setShapes=function(e){l(function(t){t.drawable.shapes=e},this.data,!1)()}.bind(this)}},{"./anim":10,"./board":12,"./configure":13,"./data":16,"./drag":17,"./fen":19}],16:[function(e,t,n){var r=e("./fen"),o=e("./configure");t.exports=function(e){var t={pieces:r.read(r.initial),orientation:"white",turnColor:"white",check:null,lastMove:null,selected:null,coordinates:!0,render:null,renderRAF:null,element:null,bounds:null,autoCastle:!1,viewOnly:!1,disableContextMenu:!1,resizable:!0,pieceKey:!1,highlight:{lastMove:!0,check:!0,dragOver:!0},animation:{enabled:!0,duration:200,current:{}},movable:{free:!0,color:"both",dests:{},dropOff:"revert",dropped:[],showDests:!0,events:{after:function(e,t,n){},afterNewPiece:function(e,t){}},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,dests:[],current:null,events:{set:function(e,t){},unset:function(){}}},predroppable:{enabled:!1,current:{},events:{set:function(e,t){},unset:function(){}}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,current:{}},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{change:function(){},move:function(e,t,n){},dropNewPiece:function(e,t){},capture:function(e,t){},select:function(e){}},items:null,drawable:{enabled:!1,eraseOnClick:!0,onChange:function(e){},shapes:[],autoShapes:[],current:{},brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"}}};return o(t,e||{}),t}},{"./configure":13,"./fen":19}],17:[function(e,t,n){function r(e){return e?e.color+e.role:""}function o(e,t,n){var r=f.key2pos(n);return"white"!==e.orientation&&(r[0]=9-r[0],r[1]=9-r[1]),{left:t.left+t.width*(r[0]-1)/8,top:t.top+t.height*(8-r[1])/8,width:t.width/8,height:t.height/8}}function i(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),u=t.target;var n=e.selected,i=f.eventPosition(t),l=e.bounds(),s=d.getKeyAtDomPos(e,i,l),c=e.pieces[s];if(n||!e.drawable.eraseOnClick&&c&&c.color===e.turnColor||p.clear(e),!e.viewOnly){var v=!!e.premovable.current,h=!!e.predroppable.current.key;d.selectSquare(e,s);var m=e.selected===s;if(c&&m&&d.isDraggable(e,s)){var g=o(e,l,s);e.draggable.current={previouslySelected:n,orig:s,piece:r(c),rel:i,epos:i,pos:[0,0],dec:e.draggable.centerPiece?[i[0]-(g.left+g.width/2),i[1]-(g.top+g.height/2)]:[0,0],bounds:l,started:e.draggable.autoDistance&&e.stats.dragged}}else v&&d.unsetPremove(e),h&&d.unsetPredrop(e);a(e)}}}function a(e){f.requestAnimationFrame(function(){var t=e.draggable.current;t.orig&&(e.animation.current.start&&e.animation.current.anims[t.orig]&&(e.animation.current={}),r(e.pieces[t.orig])!==t.piece?c(e):(!t.started&&f.distance(t.epos,t.rel)>=e.draggable.distance&&(t.started=!0),t.started&&(t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]],t.over=d.getKeyAtDomPos(e,t.epos,t.bounds)))),e.render(),t.orig&&a(e)})}function l(e,t){t.touches&&t.touches.length>1||e.draggable.current.orig&&(e.draggable.current.epos=f.eventPosition(t))}function s(e,t){var n=e.draggable.current,r=n?n.orig:null;if(r){if("touchend"===t.type&&u!==t.target&&!n.newPiece)return void(e.draggable.current={});d.unsetPremove(e),d.unsetPredrop(e);var o=f.eventPosition(t),i=o?d.getKeyAtDomPos(e,o,n.bounds):n.over;n.started&&(n.newPiece?d.dropNewPiece(e,r,i):(r!==i&&(e.movable.dropped=[r,i]),d.userMove(e,r,i)&&(e.stats.dragged=!0))),r!==n.previouslySelected||r!==i&&i?e.selectable.enabled||d.setSelected(e,null):d.setSelected(e,null),e.draggable.current={}}}function c(e){e.draggable.current.orig&&(e.draggable.current={},d.selectSquare(e,null))}var u,d=e("./board"),f=e("./util"),p=e("./draw");t.exports={start:i,move:l,end:s,cancel:c,processDrag:a}},{"./board":12,"./draw":18,"./util":23}],18:[function(e,t,n){function r(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),p.cancelMove(e);var n=v.eventPosition(t),r=e.bounds(),i=p.getKeyAtDomPos(e,n,r);e.drawable.current={orig:i,epos:n,bounds:r,brush:h[(t.shiftKey&v.isRightButton(t))+(t.altKey?2:0)]},o(e)}}function o(e){v.requestAnimationFrame(function(){var t=e.drawable.current;if(t.orig){var n=p.getKeyAtDomPos(e,t.epos,t.bounds);t.dest=t.orig===n?void 0:n}e.render(),t.orig&&o(e)})}function i(e,t){e.drawable.current.orig&&(e.drawable.current.epos=v.eventPosition(t))}function a(e,t){var n=e.drawable,r=n.current.orig,o=n.current.dest;r&&o?d(n,r,o):r&&u(n,r),n.current={},e.render()}function l(e){e.drawable.current.orig&&(e.drawable.current={})}function s(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.render(),f(e.drawable))}function c(e){return function(t){return!e(t)}}function u(e,t){var n=e.current.brush,r=function(e){return e.orig===t&&!e.dest},o=e.shapes.filter(r)[0];o&&(e.shapes=e.shapes.filter(c(r))),o&&o.brush===n||e.shapes.push({brush:n,orig:t}),f(e)}function d(e,t,n){var r=e.current.brush,o=function(e){return e.orig&&e.dest&&(e.orig===t&&e.dest===n||e.dest===t&&e.orig===n)},i=e.shapes.filter(o).length>0;i?e.shapes=e.shapes.filter(c(o)):e.shapes.push({brush:r,orig:t,dest:n}),f(e)}function f(e){e.onChange(e.shapes)}var p=e("./board"),v=e("./util"),h=["green","red","blue","yellow"];t.exports={start:r,move:i,end:a,cancel:l,clear:s,processDraw:o}},{"./board":12,"./util":23}],19:[function(e,t,n){function r(e){"start"===e&&(e=a);var t={};return e.replace(/ .+$/,"").replace(/~/g,"").split("/").forEach(function(e,n){var r=0;e.split("").forEach(function(e){var o=parseInt(e);o?r+=o:(r++,t[i.pos2key([r,8-n])]={role:l[e.toLowerCase()],color:e===e.toLowerCase()?"black":"white"})})}),t}function o(e){return[8,7,6,5,4,3,2].reduce(function(e,t){return e.replace(new RegExp(Array(t+1).join("1"),"g"),t)},i.invRanks.map(function(t){return i.ranks.map(function(n){var r=e[i.pos2key([n,t])];if(r){var o=s[r.role];return"white"===r.color?o.toUpperCase():o}return"1"}).join("")}).join("/"))}var i=e("./util"),a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",l={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},s={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};t.exports={initial:a,read:r,write:o}},{"./util":23}],20:[function(e,t,n){var r,o=function(){r=new Date},i=function(){r=null},a=function(){if(!r)return 0;

var e=new Date-r;return r=null,e};t.exports={start:o,cancel:i,stop:a}},{}],21:[function(e,t,n){function r(e,t){return Math.abs(e-t)}function o(e,t,n,o,i){return r(t,o)<2&&("white"===e?i===n+1||2>=n&&i===n+2&&t===o:i===n-1||n>=7&&i===n-2&&t===o)}function i(e,t,n,o){var i=r(e,n),a=r(t,o);return 1===i&&2===a||2===i&&1===a}function a(e,t,n,o){return r(e,n)===r(t,o)}function l(e,t,n,r){return e===n||t===r}function s(e,t,n,r){return a(e,t,n,r)||l(e,t,n,r)}function c(e,t,n,o,i,a,l){return r(o,a)<2&&r(i,l)<2||n&&i===l&&i===("white"===e?1:8)&&(5===o&&(3===a||7===a)||f.containsX(t,a))}function u(e,t){return Object.keys(e).filter(function(n){var r=e[n];return r&&r.color===t&&"rook"===r.role}).map(function(e){return f.key2pos(e)[0]})}function d(e,t,n){var r,d=e[t],p=f.key2pos(t);switch(d.role){case"pawn":r=o.bind(null,d.color);break;case"knight":r=i;break;case"bishop":r=a;break;case"rook":r=l;break;case"queen":r=s;break;case"king":r=c.bind(null,d.color,u(e,d.color),n)}return f.allPos.filter(function(e){return(p[0]!==e[0]||p[1]!==e[1])&&r(p[0],p[1],e[0],e[1])}).map(f.pos2key)}var f=e("./util");t.exports=d},{"./util":23}],22:[function(e,t,n){function r(e,t){return(e?3:4)/512*t.width}function o(e,t,n){return(e.lineWidth||10)*(t?.85:1)/512*n.width}function i(e,t){return(e.opacity||1)*(t?.9:1)}function a(e,t){return b()?0:(e?10:20)/512*t.width}function l(e,t){var n=t.width/8;return[(e[0]-.5)*n,(8.5-e[1])*n]}function s(e,t,n,o){var a=l(t,o),s=r(n,o),c=o.width/16;return{tag:"circle",attrs:{key:n?"circle-current":t+e.key,stroke:e.color,"stroke-width":s,fill:"none",opacity:i(e,n),cx:a[0],cy:a[1],r:c-s/2}}}function c(e,t,n,r,s){var c=a(r,s),u=l(t,s),d=l(n,s),f=d[0]-u[0],p=d[1]-u[1],v=Math.atan2(p,f),h=Math.cos(v)*c,m=Math.sin(v)*c;return{tag:"line",attrs:{key:r?"line-current":t+n+e.key,stroke:e.color,"stroke-width":o(e,r,s),"stroke-linecap":"round","marker-end":b()?null:"url(#arrowhead-"+e.key+")",opacity:i(e,r),x1:u[0],y1:u[1],x2:d[0]-h,y2:d[1]-m}}}function u(e,t,n,r){var o=l(t,r),i=r.width/8*(n.scale||1),a="white"===n.color?"w":"b";a+=("knight"===n.role?"n":n.role[0]).toUpperCase();var s=e.baseUrl+a+".svg";return{tag:"image",attrs:{"class":n.color+" "+n.role,x:o[0]-i/2,y:o[1]-i/2,width:i,height:i,href:s}}}function d(e){return e.length?{tag:"defs",children:e.map(function(e){return{key:e.key,tag:"marker",attrs:{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01},children:[{tag:"path",attrs:{d:"M0,0 V4 L3,2 Z",fill:e.color}}]}})}:void 0}function f(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function p(e,t,n){return function(r,o){if(r.piece)return u(e.drawable.pieces,f(g(r.orig),e.orientation),r.piece,n);if(r.brush){var i=r.brushModifiers?v(e.drawable.brushes[r.brush],r.brushModifiers,o):e.drawable.brushes[r.brush],a=f(g(r.orig),e.orientation);if(r.orig&&r.dest)return c(i,a,f(g(r.dest),e.orientation),t,n);if(r.orig)return s(i,a,t,n)}}}function v(e,t,n){return{key:"bm"+n,color:t.color||e.color,opacity:t.opacity||e.opacity,lineWidth:t.lineWidth||e.lineWidth}}function h(e,t,n){var r=[],o=[],i=n&&n.dest?t.concat(n):t;for(var a in i){var l=i[a];if(l.dest){var s=l.brush;l.brushModifiers?r.push(v(e.brushes[s],l.brushModifiers,a)):-1===o.indexOf(s)&&(r.push(e.brushes[s]),o.push(s))}}return r}var m=e("mithril/hyperscript"),g=e("./util").key2pos,b=e("./util").isTrident;t.exports=function(e){if(e.data.bounds){var t=e.data.drawable,n=t.shapes.concat(t.autoShapes);if(n.length||t.current.orig){var r=e.data.bounds();if(r.width===r.height){var o=h(t,n,t.current);return m("svg",{key:"svg"},[d(o),n.length?n.map(p(e.data,!1,r)):null,p(e.data,!0,r)(t.current,9999)])}}}}},{"./util":23,"mithril/hyperscript":3}],23:[function(e,t,n){function r(e){return w[e[0]-1]+e[1]}function o(e){return[P[e[0]],parseInt(e[1])]}function i(e){return w[8-P[e[0]]]+(9-parseInt(e[1]))}function a(e){var t=[];for(var n in e)e[n]&&t.push(n);return t.join(" ")}function l(e){return"white"===e?"black":"white"}function s(e,t){return e&&-1!==e.indexOf(t)}function c(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function u(){return"transform"in document.body.style?"transform":"webkitTransform"in document.body.style?"webkitTransform":"mozTransform"in document.body.style?"mozTransform":"oTransform"in document.body.style?"oTransform":"msTransform"}function d(){return y||(y=u()),y}function f(){return null===E&&(E=window.navigator.userAgent.indexOf("Trident/")>-1),E}function p(e){return"translate("+e[0]+"px,"+e[1]+"px)"}function v(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0}function h(e,t){return e.bind.apply(e,[null].concat(t))}function m(){return h(arguments[0],Array.prototype.slice.call(arguments,1))}function g(e){return 2===e.buttons||2===e.button}function b(e){var t,n=function(){return void 0===t&&(t=e()),t};return n.clear=function(){t=void 0},n}var y,w="abcdefgh".split(""),k=[1,2,3,4,5,6,7,8],x=[8,7,6,5,4,3,2,1],P={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8},C=function(){var e=[];return x.forEach(function(t){k.forEach(function(n){e.push([n,t])})}),e}(),M=C.map(r),S=M.slice(0).reverse(),E=null;t.exports={files:w,ranks:k,invRanks:x,allPos:C,allKeys:M,invKeys:S,pos2key:r,key2pos:o,invertKey:i,classSet:a,opposite:l,translate:p,containsX:s,distance:c,eventPosition:v,partialApply:h,partial:m,transformProp:d,isTrident:f,requestAnimationFrame:(window.requestAnimationFrame||window.setTimeout).bind(window),isRightButton:g,memo:b}},{}],24:[function(e,t,n){function r(e){return e.role+" "+e.color}function o(e,t,n){var o={key:"p"+t,style:{},"class":r(e.pieces[t])},i=a(b.key2pos(t),n),l=e.draggable.current;if(l.orig===t&&l.started)i[0]+=l.pos[0]+l.dec[0],i[1]+=l.pos[1]+l.dec[1],o["class"]+=" dragging";else if(e.animation.current.anims){var s=e.animation.current.anims[t];s&&(i[0]+=s[1][0],i[1]+=s[1][1])}return o.style[n.transformProp]=b.translate(i),e.pieceKey&&(o["data-key"]=t),x(P,void 0,o)}function i(e,t,n){var r={key:"s"+e,"class":t,style:{}};return r.style[n.transformProp]=b.translate(a(b.key2pos(e),n)),x(C,void 0,r)}function a(e,t){return[(t.asWhite?e[0]-1:8-e[0])*t.bounds.width/8,(t.asWhite?8-e[1]:e[1]-1)*t.bounds.height/8]}function l(e,t,n){if(t){var o={style:{},"class":r(t)+" ghost"};return o.style[n.transformProp]=b.translate(a(b.key2pos(e),n)),x(P,"g"+e,o)}}function s(e,t){var n={key:"f"+e.piece.key,"class":"fading "+r(e.piece),style:{opacity:e.opacity}};return n.style[t.transformProp]=b.translate(a(e.piece.pos,t)),x(P,void 0,n)}function c(e,t,n){e[t]?e[t].push(n):e[t]=[n]}function u(e,t){var n=e.data,r={};if(n.lastMove&&n.highlight.lastMove&&n.lastMove.forEach(function(e){c(r,e,"last-move")}),n.check&&n.highlight.check&&c(r,n.check,"check"),n.selected){c(r,n.selected,"selected");var o=n.draggable.current.over,a=n.movable.dests[n.selected];a&&a.forEach(function(e){e===o?c(r,e,"move-dest drag-over"):n.movable.showDests&&c(r,e,"move-dest"+(n.pieces[e]?" oc":""))});var l=n.premovable.dests;l&&l.forEach(function(e){e===o?c(r,e,"premove-dest drag-over"):n.movable.showDests&&c(r,e,"premove-dest"+(n.pieces[e]?" oc":""))})}var s=n.premovable.current;s?s.forEach(function(e){c(r,e,"current-premove")}):n.predroppable.current.key&&c(r,n.predroppable.current.key,"current-premove"),e.vm.exploding&&e.vm.exploding.keys.forEach(function(t){c(r,t,"exploding"+e.vm.exploding.stage)});var u=[];if(n.items)for(var d=0;64>d;d++){var f=b.allKeys[d],p=r[f],v=n.items.render(b.key2pos(f),f);if(p||v){var h=i(f,p?p.join(" ")+(v?" has-item":""):"has-item",t);v&&(h.children=[v]),u.push(h)}}else for(var f in r)u.push(i(f,r[f].join(" "),t));return u}function d(e){var t=e.data;if(t.bounds){var n={asWhite:"white"===t.orientation,bounds:t.bounds(),transformProp:b.transformProp()},r=[x("[","squares",void 0,u(e,n))];t.animation.current.fadings&&r.push(x("[","fadings",void 0,t.animation.current.fadings.map(function(e){return s(e,n)})));var i=[],a=n.asWhite?b.allKeys:b.invKeys;if(t.items)for(var c=0;64>c;c++)t.pieces[a[c]]&&!t.items.render(b.key2pos(a[c]),a[c])&&i.push(o(t,a[c],n));else for(var c=0;64>c;c++)t.pieces[a[c]]&&i.push(o(t,a[c],n));if(r.push(x("[","pieces",void 0,i)),t.draggable.showGhost){var d=t.draggable.current.orig;d&&!t.draggable.current.newPiece&&r.push(l(d,t.pieces[d],n))}if(t.drawable.enabled){var f=y(e);f&&r.push(f)}return r}}function f(e){return function(t){b.isRightButton(t)&&e.draggable.current.orig?(e.draggable.current.newPiece&&delete e.pieces[e.draggable.current.orig],e.draggable.current={},e.selected=null):(t.shiftKey||b.isRightButton(t))&&e.drawable.enabled?g.start(e,t):m.start(e,t)}}function p(e,t,n){return function(r){(r.shiftKey||b.isRightButton(r))&&e.drawable.enabled?n(e,r):e.viewOnly||t(e,r)}}function v(e,t){var n=e.data,r=f(n),o=p(n,m.move,g.move),i=p(n,m.end,g.end),a=["touchstart","mousedown"],l=["touchmove","mousemove"],s=["touchend","mouseup"];a.forEach(function(e){t.addEventListener(e,r)}),l.forEach(function(e){document.addEventListener(e,o)}),s.forEach(function(e){document.addEventListener(e,i)})}function h(e){var t=e.data;return x("div",void 0,{"class":"cg-board orientation-"+t.orientation,oncreate:function(n){var r=n.dom;(!t.viewOnly||t.drawable.enabled)&&v(e,r),t.render=function(){k.render(r,d(e))},t.renderRAF=function(){b.requestAnimationFrame(t.render)},t.bounds=b.memo(r.getBoundingClientRect.bind(r)),t.element=r,t.render()}})}var m=e("./drag"),g=e("./draw"),b=e("./util"),y=e("./svg"),w=e("./coords"),k=e("mithril/render"),x=e("mithril/render/vnode"),P="piece",C="square";t.exports=function(e){var t=e.data;return x("div",void 0,{oncreate:function(e){var n=e.dom;t.coordinates&&(t.redrawCoords=w(t.orientation,n)),n.addEventListener("contextmenu",function(e){return t.disableContextMenu||t.drawable.enabled?(e.preventDefault(),!1):void 0}),t.resizable&&document.body.addEventListener("chessground.resize",function(e){t.bounds.clear(),t.render()},!1),["onscroll","onresize"].forEach(function(e){var n=window[e];window[e]=function(){n&&n(),t.bounds.clear()}})},onupdate:function(e){t.redrawCoords&&t.redrawCoords(t.orientation)},"class":["cg-board-wrap",t.viewOnly?"view-only":"manipulable"].join(" ")},[h(e)])}},{"./coords":14,"./drag":17,"./draw":18,"./svg":22,"./util":23,"mithril/render":4,"mithril/render/vnode":9}]},{},[1])(1)});